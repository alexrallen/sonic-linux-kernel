From 9b130f2965e27106f0507bac84b0b33d2f6b601e Mon Sep 17 00:00:00 2001
From: Alexander Allen <arallen@nvidia.com>
Date: Wed, 11 May 2022 14:17:01 +0300
Subject: [PATCH] Fix inline atomics not available on arm server

---
 arch/arm64/Makefile | 2 ++
 1 file changed, 2 insertions(+)

diff --git a/arch/arm64/Makefile b/arch/arm64/Makefile
index 485b7dbd4..4c8d1f7c1 100644
--- a/arch/arm64/Makefile
+++ b/arch/arm64/Makefile
@@ -44,6 +44,8 @@ ifeq ($(CONFIG_BROKEN_GAS_INST),y)
 $(warning Detected assembler with broken .inst; disassembly will be unreliable)
 endif
 
+KBUILD_CFLAGS   += -mno-outline-atomics
+
 KBUILD_CFLAGS	+= -mgeneral-regs-only	\
 		   $(compat_vdso) $(cc_has_k_constraint)
 KBUILD_CFLAGS	+= $(call cc-disable-warning, psabi)
-- 
2.25.1

